title: 年轻人的第一台软路由 - NanoPi R2S 开箱
date: 2020-07-10 20:23:26
toc: true
categories: 技术向
tags: []
thumbnail: https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943733485340.jpg!webp_1920w
---
一直以来，家里的小米路由器3都在承受着它这个年纪不应该承受的痛苦，无论是 Samba 文件共享还是打印机共享或是某不可描述服务，全部都由 128MB 小内存的它独自默默承担

面对着黑心老板 Hans362 的压榨，它选择了通过减慢速度、频繁死机上不了网、多次掉盘丢数据等多种方式，成功地让我抛弃了它

更为致命的是小米路由器3作为一款所谓的“千兆路由器”，“千兆”居然指的是 WLAN 传输速率，而 WAN/LAN 口全部都是 100Mbps，这不是脱裤子放屁嘛🤔

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943670300207.jpg!webp_1920w)

（小米路由器3包装盒，确实写着千兆路由器，然而指的是 WLAN 速率，要你有何用？恕我直言，小米的路由器就垃圾，还是别碰比较好）

于是趁着这段时间有空，自己瞎入了一款 ARMv8 开发板，是 FriendlyARM 友善之臂的 NanoPi R2S，来开箱做个测评，顺便谈谈我是如何用它优化家里的网络的～

<!--more-->

## 为什么选择它？

之所以选择这样一款 ARM 软路由而不是 X86 软路由，主要是因为...穷😂

像 X86 的经典代表 J1900 基本上裸机不带内存条和硬盘都要300起步，家里也没有闲置的内存条之类的，加上内存和硬盘后根本承受不起，至于那些 X86 矿渣虽然便宜但是也不敢买，稳定性得不到保障

还有就算买得起功耗和噪音也是个大问题，家里人大概率也不会同意

而这款 NanoPi R2S 主要看中的是它小巧的外形、支持 AES 的处理器、1GB 的内存以及两个千兆网口（虽然一个是 Soc 直接引出另一个是 USB 3.0 转的），5V2A 的供电也确保了它功耗不会过高

需要注意的是 NanoPi R2S 没有无线功能，板载的 USB2.0 如果接上无线网卡网速惨不忍睹，因此需要自行准备一个无线 AP

## 购买和开箱

我是在在某宝上买的，单板¥155，听说这小东西发热量特别厉害，所以果断一步到位加了定制金属外壳，另外还加了一张16GB Class10 TF卡、一个读卡器以及一根 USB 线，一共¥279

至于 USB 供电头其实可以不买，从光猫的 USB 口上取电就可以了，别使用 5V/9V/12V 的那种自适应快充充电头就行

收到货有三样东西，分别是单板、配件和TF卡

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943684088445.jpg!webp_1920w)

开箱！

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943686567510.jpg!webp_1920w)

金属外壳做工很棒～还挺沉的～

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943686567757.jpg!webp_1920w)

板子处理器是 RockChip RK3328，两块螃蟹🦀️网卡，一个TF插槽，一个 USB2.0 接口，一个 Micro USB 供电口（很想吐槽为什么处理器支持 USB3.0 却不弄个 USB3.0 的口子...）

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943686568233.jpg!webp_1920w)

组装过程很简单，装好后用 Etcher 刷个系统，因为想玩 Docker 所以刷了 Lean 大佬的固件

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943690353870.jpg!webp_1920w)

然后网线接到 LAN 口，浏览器输入 friendlywrt 就可以进入后台啦

## 网络大改造

先来看看优化前家里的网络拓扑图：

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943692438945.png!webp_1920w)

可以说是接得乱七八糟，硬生生被我划出三个网段（虽然可以互通但是很不方便），而且所有的连接最大速率都是 100Mbps，白白浪费了家里的 500Mbps 带宽

以下就是购入 NanoPi R2S 后我对家里网络的优化过程～

### 设置旁路由

由于家里没有交换机，R2S 只有两个网口，而 AP（小米路由器3）所有端口全部为 100Mbps，因此我要把光猫上的几个千兆口也利用上，就只能组建旁路由了

旁路由其实并不是路由，严格来说应该叫做旁路网关，所有的流量会先到它那里走一遭再发往各处

具体的设置方法是先将电脑与 R2S 的 LAN 口连接，打开 LuCI-网络-接口，把除 LAN 之外的接口都删除

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943696880724.jpg!webp_1920w)

修改 LAN 接口，把 IPv4 地址修改成和上级路由（我这里是光猫）同一网段的 IP 地址，我这里光猫是 192.168.1.1 所以我把 R2S 设置成了 192.168.1.253，其余空自行填写，下图仅供参考，勿无脑抄写，写完切记只点保存，千万不要应用，不然就连不上 LuCI 了

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943701889413.jpg!webp_1920w)

同理修改如下两处设置，同样根据实际情况填写，不要直接照抄哦，填完也只点保存，千万不要应用

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943702043902.jpg!webp_1920w)

（把桥接去掉，并把原先的 WAN 口也就是 eth0 改成 LAN 口）

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943702044364.jpg!webp_1920w)

（启用强制，配置 DHCP 选项）

最后前往 LuCI-网络-防火墙-自定义规则，加入这一句：

`iptables -t nat -I POSTROUTING -j MASQUERADE`

然后保存并应用所有设置～

此时拔下 R2S 上的网线，将光猫的一个 LAN 口与 R2S eth0 对应的口子相连，电脑连接光猫 LAN 口，进入光猫超级后台关闭 DHCP

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943705349632.jpg!webp_1920w)

此时应该就能上网了～输入之前设置的旁路由 IP 地址也能进入 LuCI～

把小米路由器3 WAN 口连接到光猫 LAN 口，选择有线中继就可以做纯 AP 了，而且下面的无线设备也是在 192.168.1.X 的网段里的

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943732266412.jpg!webp_1920w)

于是新的网络拓扑图变成了这样：

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943706213207.png!webp_1920w)

（注：由于 AP 没换所以无线设备的最大速率还是 100Mbps）

### 测个速

局域网测速结果：千兆跑满

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943707768254.jpg!webp_1920w)

电信测试结果：500Mbps 跑满

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/15/15947996046352.png!webp_1920w)

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/15/15947996963090.png!webp_1920w)

Speedtest.net 测试结果：500Mbps 跑满（因为某些原因显示成了 Google Cloud

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/15/15947996869850.jpg!webp_1920w)

某不可描述测试：

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/15/15947997383283.png!webp_1920w)

某不可描述测试x2：（用的是 WiFi 在 iPad 上测的...其实远不止这点）

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943709722321.jpg!webp_1920w)

### Docker 玩起来

LuCI 上有 Docker 的相关说明，安装教程配置好 Portainer 然后就好办了

于是我就跑了亿点点东西：

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943710711318.jpg!webp_1920w)

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943711126092.jpg!webp_1920w)
（做下载机）

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943711699739.jpg!webp_1920w)
（NextCloud 是好文明（

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/10/15943712532877.jpg!webp_1920w)
（自己的 Git 仓库～~~弃用 GitHub 指日可待~~

![](https://blog-img-1251828412.image.myqcloud.com/2020/07/15/15947998301885.jpg!webp_1920w)
![](https://blog-img-1251828412.image.myqcloud.com/2020/07/15/15947998302370.png!webp_1920w)
（利用 HomeAssistant 将米家生态链产品接入 HomeKit）

除此之外还有 Samba 共享、打印机共享等

## 现存问题

并不是说 R2S 就很完美并且适合所有人，经过一段时间的使用我也发现它存在如下问题：

### 温度过高

没错，即使是使用金属外壳，一般情况下它的温度也会在50到70度波动，如果正在进行下载任务则有可能飙到80度，而高温对于 CPU 的寿命是有很大的影响的，这一点还有待改进

目前有一种金属外壳+风扇的方案应该说会比较好一点，可以考虑购入这种类型的（原装塑料外壳建议别考虑了，除非真的是极轻度使用）

### 小白不友好

如果你真的是个小白，对于一些基础的计算机网络知识一概不知，也不了解 OpenWRT 系统的使用和配置，那么奉劝最好别买～

相反，如果你非常热爱折腾，同时正在寻求一款廉价的软路由，那这款就比较适合你～

### 软件包不完善

软件生态还有待改进...

比如缺少 CUPS 打印服务相关的软件包，导致我不得不使用 Docker 来实现打印机共享

## 总结

那么总的来说还是很满意的，NanoPi R2S 解决了我一直以来的上网问题，附带的 Docker CE 也增添了很多有意思的玩法，至于能稳定使用多久就要留给时间去检验了～









